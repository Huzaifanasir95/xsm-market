# Minimal .htaccess for XSM Market
RewriteEngine On

# Set default index files
DirectoryIndex index.html index.php

# Basic CORS headers for API
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</IfModule>

# Handle NOWPayments webhook directly - CRITICAL for IPN
RewriteRule ^api/webhooks/nowpayments/?$ api/webhooks/nowpayments.php [QSA,L]

# Handle uploaded files directly - serve static files (MUST come before api catch-all)
RewriteRule ^api/uploads/(.+\.(jpg|jpeg|png|gif|webp|mp4|avi|mov|pdf|doc|docx))$ api/uploads/$1 [L]

# Handle other API requests through index.php
RewriteRule ^api/(.*)$ api/index.php [QSA,L]

# Handle React Router (fallback to index.html)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/api/
RewriteRule . /index.html [L]

# Basic security - protect sensitive files
<Files ".env*">
    Order deny,allow
    Deny from all
</Files>

<Files "*.log">
    Order deny,allow
    Deny from all
</Files>

# PHP Configuration for uploads
php_value upload_max_filesize 50M
php_value post_max_size 50M
php_value max_execution_time 300
php_value memory_limit 256M
